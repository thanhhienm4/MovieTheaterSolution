
@{
    ViewData["Title"] = "UpdateSeatInRoom";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Sơ đồ ghế rạp phim</h2>
    <div class="card bg-secondary text-white">
        <div class="card-body d-flex justify-content-center" style="font-size:120%">
            Màn hình
        </div>
    </div>
    <div class="card bg-light"> 
        <div class="card-body">
            <div class="container-fluid">
                <div style="overflow-x:auto;">
                    <ul id="place">
                    </ul>
                </div>
                
            </div>
            
        </div>
         
    </div>

    <div style="float:left;"> 

    </div>
    <div style="clear:both;width:100%">
        <button id="btnUpdate">Cập nhật</button>
        <button id="normal" onclick="changeMode(this)">Ghế thường</button>
        <button id="vip" onclick="changeMode(this)">Ghế VIP</button>
    </div>

  

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<style type="text/css">
    #holder{    
    padding: 10px;
    height:200px;    
    width:550px;
    background-color:#F5F5F5;
    border:1px solid #A4A4A4;
    margin-left:10px;   
    }
    #place {
    position:relative;
    margin:7px;
    }
    #place a{
    font-size:0.6em;
    }
    #place li
    {
     list-style: none outside none;
     position: absolute;   
    }

        #place .seat {
            background-color: #fff;
            border-radius: 10%;
            height: 40px;
            width: 40px;
            display: block;
        }
        #place .vipSeat {
            background-color: #26b9cc;
        }
        #place .normalSeat {
            background-color: #1cc88a;
        }
    #place .row-3, #place .row-4{
    margin-top:10px;
    }
    #seatDescription li{
    verticle-align:middle;    
    list-style: none outside none;
    padding-left:35px;
    height:35px;
    float:left;
    }
</style>
<script type="text/javascript">
    var mode = { normal: 1, vip: 2 };
    var modeNow = mode.normal;

    var settings = {
        rows: 10,
        cols: 25,
        rowCssPrefix: 'row-',
        colCssPrefix: 'col-',
        seatWidth: 35,
        seatHeight: 35,
        seatCss: 'seat',
        vipSeatCss: 'vipSeat',
        normalSeatCss: 'normalSeat'
    };
    var listRow = [];
    function changeMode(btn) {
        switch ($(btn).attr('id')) {
            case 'normal':
                modeNow = mode.normal;
                break;
            case 'vip':
                modeNow = mode.vip;
                break;

        }
    }
    $(document).ready(function () {
    


    $.ajax({
        type: "Get",
        url: "/SeatRow/GetAllSeatRows",
        success: function (result) {
            var init = function () {
                var str = [], seatNo, className;
                settings.rows = result.length;
                for (i = 0; i < settings.rows; i++) {
                    str.push('<div class="row">');
                    str.push('<div class="btn-group">');
                    for (j = 0; j < settings.cols; j++) {
                        seatNo = result[i].name + j.toString();
                        className = settings.seatCss;

                        str.push('<button id = "' + result[i].id + '_' + j.toString() + '" class = "' + className + '"' + 'data-kindofseatid="' + result[i].kindOfSeatId +
                            '"data-row="' + result[i].id + '"data-num="' + j.toString() +'" > ' +
                            '<a title="' + seatNo + '">' + seatNo + '</a>' +
                            '</button>');
                    }
                    str.push('</div>');
                    str.push('</div>');
                }
                $('#place').html(str.join(''));

                $.ajax({
                    type: "GET",
                    url: "/Room/GetSeatInRoom",
                    data: { roomId : @ViewBag.RoomId },
                    success: function (res) {
                        for (var i = 0; i < res.length;i++)
                        {
                            var idElement = res[i].rowId + '_' + res[i].number.toString();
                            var btn = document.getElementById(idElement);
                            if (res[i].kindOfSeatId == mode.normal) {
                                $(btn).addClass(settings.normalSeatCss);
                            }

                            else {
                                $(btn).addClass(settings.vipSeatCss);
                            }
                            $(btn).attr('data-kindofseatid', res[i].kindOfSeatId);
                               
                        };
                    }
                });
            };
            //case I: Show from starting

            //Case II: If already booked
            init();
            $('.' + settings.seatCss).click(function () {
                if (modeNow == mode.normal) {
                    $(this).removeClass(settings.vipSeatCss);
                    $(this).toggleClass(settings.normalSeatCss);
                }
                else {
                    $(this).removeClass(settings.normalSeatCss)
                    $(this).toggleClass(settings.vipSeatCss);

                }


                $(this).attr('data-kindofseatid', modeNow.toString());
            });
        }
    })






$('#btnUpdate').click(function () {
            var seats = [];
    $.each($('#place button.' + settings.vipSeatCss + ', #place button.' + settings.normalSeatCss), function (index, value) {
        var seat = {
            RoomId: @ViewBag.RoomId,
            RowId: $(this).attr('data-row'),
            Number: $(this).attr('data-num'),
            KindOfSeatId: $(this).attr('data-kindofseatid')
        };
        seats.push(seat);
    });

    $.ajax({
        type: "Post",
        url: "/Room/UpdateSeatInRoom",
        data: { Seats: seats, RoomId: @ViewBag.RoomId }
        });
    })
    });


</script>

